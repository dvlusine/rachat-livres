<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rachat livres</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 16px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 12px; margin-bottom: 12px; }
    .row { display: grid; grid-template-columns: 1fr 90px 90px 100px; gap: 8px; align-items: center; }
    .row.header { font-weight: 600; font-size: 13px; opacity: .8; }
    .row + .row { margin-top: 8px; }
    input[type="number"] { width: 100%; padding: 8px; border-radius: 10px; border: 1px solid #ccc; font-size: 16px; }
    .name { font-size: 14px; }
    .total { text-align: right; font-variant-numeric: tabular-nums; }
    .footer { display: flex; gap: 8px; flex-wrap: wrap; }
    button {
      padding: 10px 12px; border-radius: 10px; border: 1px solid #ccc;
      background: #f7f7f7; font-size: 15px;
    }
    .grandtotal { font-size: 18px; font-weight: 700; }
    .hint { font-size: 12px; opacity: .7; margin-top: 6px; }
    .pill { display:inline-block; padding: 2px 8px; border:1px solid #ddd; border-radius: 999px; font-size: 12px; opacity:.85;}
    @media (max-width: 480px) {
      .row { grid-template-columns: 1fr 80px 80px 92px; }
    }
  </style>
</head>
<body>
  <h1>Rachat livres <span class="pill">calcul rapide</span></h1>

  <div class="card">
    <div class="row header">
      <div>Catégorie</div>
      <div>€/unité</div>
      <div>Qté</div>
      <div style="text-align:right;">Total</div>
    </div>
    <div id="lines"></div>
    <div class="row" style="margin-top:12px; border-top:1px dashed #ddd; padding-top:10px;">
      <div class="grandtotal">TOTAL</div>
      <div></div><div></div>
      <div class="grandtotal total" id="grandTotal">0,00 €</div>
    </div>
    <div class="hint">Astuce : tu peux modifier les €/unité selon ta reprise (0,20 / 0,30 / 0,50…).</div>
  </div>

  <div class="footer">
    <button id="resetBtn">Remise à zéro</button>
    <button id="roundBtn">Arrondir au €</button>
    <button id="saveBtn">Sauver</button>
    <button id="loadBtn">Charger</button>
  </div>

  <script>
    const categories = [
      { name: "Livre de poche", price: 0.30 },
      { name: "Roman grand format", price: 1.00 },
      { name: "Livre enfant souple", price: 0.30 },
      { name: "Livre enfant rigide", price: 0.50 },
      { name: "Livre bébé cartonné", price: 0.30 },
      { name: "BD classique", price: 1.00 },
      { name: "Manga", price: 0.50 },
      { name: "Comics", price: 1.00 },
      { name: "Beau livre", price: 2.00 },
    ];

    const linesEl = document.getElementById("lines");
    const grandTotalEl = document.getElementById("grandTotal");

    function euro(n) {
      return (Math.round(n * 100) / 100).toLocaleString("fr-FR", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " €";
    }

    function render() {
      linesEl.innerHTML = "";
      categories.forEach((c, idx) => {
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `
          <div class="name">${c.name}</div>
          <input type="number" step="0.01" min="0" inputmode="decimal" value="${c.price}" data-kind="price" data-idx="${idx}">
          <input type="number" step="1" min="0" inputmode="numeric" value="${c.qty || 0}" data-kind="qty" data-idx="${idx}">
          <div class="total" id="lineTotal-${idx}">0,00 €</div>
        `;
        linesEl.appendChild(row);
      });

      linesEl.addEventListener("input", onInput);
      recalc();
    }

    function onInput(e) {
      const t = e.target;
      const idx = Number(t.dataset.idx);
      if (Number.isNaN(idx)) return;

      if (t.dataset.kind === "price") {
        categories[idx].price = Number(t.value || 0);
      } else if (t.dataset.kind === "qty") {
        categories[idx].qty = Number(t.value || 0);
      }
      recalc();
    }

    function recalc() {
      let gt = 0;
      categories.forEach((c, idx) => {
        const line = (Number(c.price) || 0) * (Number(c.qty) || 0);
        gt += line;
        const el = document.getElementById(`lineTotal-${idx}`);
        if (el) el.textContent = euro(line);
      });
      grandTotalEl.textContent = euro(gt);
      window._grandTotal = gt;
    }

    function resetAll() {
      categories.forEach(c => c.qty = 0);
      render();
    }

    function roundToEuro() {
      const r = Math.round(window._grandTotal || 0);
      grandTotalEl.textContent = euro(r);
    }

    function save() {
      const payload = categories.map(c => ({ name: c.name, price: c.price, qty: c.qty || 0 }));
      localStorage.setItem("rachatLivres", JSON.stringify(payload));
      alert("Sauvegardé ✅");
    }

    function load() {
      const raw = localStorage.getItem("rachatLivres");
      if (!raw) { alert("Rien à charger."); return; }
      try {
        const payload = JSON.parse(raw);
        payload.forEach((p, i) => {
          if (!categories[i]) return;
          categories[i].price = Number(p.price) || categories[i].price;
          categories[i].qty = Number(p.qty) || 0;
        });
        render();
        alert("Chargé ✅");
      } catch {
        alert("Sauvegarde invalide.");
      }
    }
 
    document.getElementById("resetBtn").addEventListener("click", resetAll);
    document.getElementById("roundBtn").addEventListener("click", roundToEuro);
    document.getElementById("saveBtn").addEventListener("click", save);
    document.getElementById("loadBtn").addEventListener("click", load);

    render();
  </script>
</body>
</html>

